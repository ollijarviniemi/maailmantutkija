{
  "meta": {
    "id": "inference-chain-test",
    "title": "Bayesian Inference Chain Test",
    "description": "Tests complex Bayesian inference: Sack → Duplicator → Shuffler (with retention) → Filter → Observation. Tests cross-cycle dependencies and multi-output tracking.",
    "bettingConfig": {
      "granularity": 20
    }
  },
  "grid": {
    "width": 10,
    "height": 8
  },
  "components": [
    {
      "id": 1,
      "type": "sack",
      "position": {"x": 1, "y": 3},
      "params": {
        "color": "red",
        "direction": "right"
      }
    },
    {
      "id": 2,
      "type": "conveyor",
      "position": {"x": 2, "y": 3},
      "params": {
        "direction": "right"
      }
    },
    {
      "id": 3,
      "type": "duplicator",
      "position": {"x": 3, "y": 3},
      "params": {
        "copies": 4,
        "outputPattern": [
          {"side": "right", "count": 2},
          {"side": "down", "count": 2}
        ],
        "plex": true,
        "outputDelay": 500
      }
    },
    {
      "id": 4,
      "type": "conveyor",
      "position": {"x": 4, "y": 3},
      "params": {
        "direction": "right"
      }
    },
    {
      "id": 5,
      "type": "shuffler",
      "position": {"x": 5, "y": 3},
      "params": {
        "numInputs": 2,
        "input1Side": "left",
        "input2Side": "up",
        "minBufferSize": 4,
        "outputPattern": [
          {"side": "right", "count": 2},
          {"retain": true, "count": 2}
        ],
        "outputDelay": 600
      }
    },
    {
      "id": 6,
      "type": "conveyor",
      "position": {"x": 5, "y": 2},
      "params": {
        "direction": "down"
      }
    },
    {
      "id": 7,
      "type": "conveyor",
      "position": {"x": 3, "y": 4},
      "params": {
        "direction": "right"
      }
    },
    {
      "id": 8,
      "type": "conveyor",
      "position": {"x": 4, "y": 4},
      "params": {
        "direction": "right"
      }
    },
    {
      "id": 9,
      "type": "conveyor-turn",
      "position": {"x": 5, "y": 4},
      "params": {
        "turnType": "left-to-up"
      }
    },
    {
      "id": 10,
      "type": "conveyor",
      "position": {"x": 6, "y": 3},
      "params": {
        "direction": "right"
      }
    },
    {
      "id": 11,
      "type": "filter",
      "position": {"x": 7, "y": 3},
      "params": {
        "capacity": 3,
        "targetColor": "red",
        "direction": "left",
        "matchOutputSide": "right",
        "nonMatchOutputSide": "left",
        "plex": true,
        "outputDelay": 500
      }
    },
    {
      "id": 12,
      "type": "observation",
      "position": {"x": 8, "y": 3},
      "params": {
        "label": "Match (Red)",
        "ballScale": 0.15
      }
    },
    {
      "id": 13,
      "type": "observation",
      "position": {"x": 6, "y": 3},
      "params": {
        "label": "Non-Match",
        "ballScale": 0.15
      }
    },
    {
      "id": 14,
      "type": "sack",
      "position": {"x": 1, "y": 1},
      "params": {
        "color": "blue",
        "direction": "right"
      }
    },
    {
      "id": 15,
      "type": "conveyor",
      "position": {"x": 2, "y": 1},
      "params": {
        "direction": "right"
      }
    },
    {
      "id": 16,
      "type": "conveyor",
      "position": {"x": 3, "y": 1},
      "params": {
        "direction": "right"
      }
    },
    {
      "id": 17,
      "type": "conveyor",
      "position": {"x": 4, "y": 1},
      "params": {
        "direction": "right"
      }
    },
    {
      "id": 18,
      "type": "conveyor",
      "position": {"x": 5, "y": 1},
      "params": {
        "direction": "down"
      }
    },
    {
      "id": 19,
      "type": "arm",
      "position": {"x": 8, "y": 5},
      "params": {
        "armType": "sample-single",
        "sampleRate": 0.5
      }
    },
    {
      "id": 20,
      "type": "conveyor",
      "position": {"x": 7, "y": 5},
      "params": {
        "direction": "right"
      }
    },
    {
      "id": 21,
      "type": "conveyor",
      "position": {"x": 6, "y": 5},
      "params": {
        "direction": "right"
      }
    },
    {
      "id": 22,
      "type": "conveyor",
      "position": {"x": 5, "y": 5},
      "params": {
        "direction": "right"
      }
    },
    {
      "id": 23,
      "type": "merger",
      "position": {"x": 4, "y": 5},
      "params": {
        "direction": "right"
      }
    },
    {
      "id": 24,
      "type": "conveyor",
      "position": {"x": 3, "y": 5},
      "params": {
        "direction": "right"
      }
    },
    {
      "id": 25,
      "type": "conveyor",
      "position": {"x": 2, "y": 5},
      "params": {
        "direction": "right"
      }
    },
    {
      "id": 26,
      "type": "sack",
      "position": {"x": 1, "y": 5},
      "params": {
        "color": "green",
        "direction": "right"
      }
    },
    {
      "id": 27,
      "type": "conveyor",
      "position": {"x": 4, "y": 6},
      "params": {
        "direction": "up"
      }
    },
    {
      "id": 28,
      "type": "conveyor",
      "position": {"x": 4, "y": 7},
      "params": {
        "direction": "up"
      }
    },
    {
      "id": 29,
      "type": "sack",
      "position": {"x": 3, "y": 7},
      "params": {
        "color": "purple",
        "direction": "right"
      }
    },
    {
      "id": 30,
      "type": "observation",
      "position": {"x": 8, "y": 6},
      "params": {
        "label": "Sampled",
        "ballScale": 0.15
      }
    }
  ],
  "connections": [
    {"from": 1, "to": 2},
    {"from": 2, "to": 3},
    {"from": 3, "to": 4, "fromPort": "right"},
    {"from": 4, "to": 5},
    {"from": 3, "to": 7, "fromPort": "down"},
    {"from": 7, "to": 8},
    {"from": 8, "to": 9},
    {"from": 9, "to": 6},
    {"from": 6, "to": 5},
    {"from": 5, "to": 10},
    {"from": 10, "to": 11},
    {"from": 11, "to": 12, "fromPort": "right"},
    {"from": 11, "to": 13, "fromPort": "left"},
    {"from": 14, "to": 15},
    {"from": 15, "to": 16},
    {"from": 16, "to": 17},
    {"from": 17, "to": 18},
    {"from": 18, "to": 5},
    {"from": 26, "to": 25},
    {"from": 25, "to": 24},
    {"from": 24, "to": 23},
    {"from": 29, "to": 28},
    {"from": 28, "to": 27},
    {"from": 27, "to": 23},
    {"from": 23, "to": 22},
    {"from": 22, "to": 21},
    {"from": 21, "to": 20},
    {"from": 20, "to": 19},
    {"from": 19, "to": 30}
  ],
  "hypothesisSpace": {
    "type": "independent",
    "components": {
      "1": {
        "alternatives": [
          {"color": "red"},
          {"color": "blue"}
        ]
      },
      "14": {
        "alternatives": [
          {"color": "red"},
          {"color": "blue"}
        ]
      },
      "26": {
        "alternatives": [
          {"color": "green"},
          {"color": "purple"}
        ]
      },
      "29": {
        "alternatives": [
          {"color": "green"},
          {"color": "purple"}
        ]
      }
    }
  },
  "hypothesisScript": "// Complex inference test with 4 sacks\n// Tests: Duplication tracking, Shuffler retention cross-cycle dependencies,\n// Filter color routing, Merger from multiple sources\n\nsack(1, [\n  {color: 'red'},\n  {color: 'blue'}\n]);\n\nsack(14, [\n  {color: 'red'},\n  {color: 'blue'}\n]);\n\nsack(26, [\n  {color: 'green'},\n  {color: 'purple'}\n]);\n\nsack(29, [\n  {color: 'green'},\n  {color: 'purple'}\n]);\n\nbuckets(20);",
  "samplingSchedule": null,
  "simulation": {
    "ballProductionInterval": 2500,
    "ballSpeed": 1.0,
    "ballsToSpawn": 20,
    "seed": 42
  }
}
