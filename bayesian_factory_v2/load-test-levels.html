<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Load Test Levels - Bayesian Factory v2</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #1a1a1a;
      color: #e0e0e0;
    }
    h1 {
      color: #4CAF50;
      text-align: center;
    }
    .level-card {
      background: #2a2a2a;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    .level-card h2 {
      margin-top: 0;
      color: #64B5F6;
    }
    .level-card p {
      color: #b0b0b0;
      line-height: 1.6;
    }
    .level-card ul {
      color: #b0b0b0;
      line-height: 1.8;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
      margin-right: 10px;
      margin-top: 10px;
    }
    button:hover {
      background: #45a049;
    }
    button.secondary {
      background: #2196F3;
    }
    button.secondary:hover {
      background: #0b7dda;
    }
    button.danger {
      background: #f44336;
    }
    button.danger:hover {
      background: #da190b;
    }
    .status {
      margin-top: 20px;
      padding: 15px;
      border-radius: 5px;
      display: none;
    }
    .status.success {
      background: #1b5e20;
      border: 1px solid #4CAF50;
      display: block;
    }
    .status.error {
      background: #b71c1c;
      border: 1px solid #f44336;
      display: block;
    }
    .info-box {
      background: #1a237e;
      border: 1px solid #3f51b5;
      border-radius: 5px;
      padding: 15px;
      margin: 20px 0;
    }
    .info-box h3 {
      margin-top: 0;
      color: #90caf9;
    }
    code {
      background: #000;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
    }
  </style>
</head>
<body>
  <h1>üß™ Test Level Loader</h1>

  <div class="info-box">
    <h3>Instructions</h3>
    <p>Click the buttons below to load test levels into localStorage. Once loaded, you can access them in the editor using the "Load Level" button.</p>
    <p><strong>Note:</strong> Loading will add to existing levels (won't delete your work).</p>
  </div>

  <div class="level-card">
    <h2>1. Comprehensive Test Level</h2>
    <p><strong>Best to start with this one!</strong></p>
    <p><strong>Purpose:</strong> Integration test of all revised components working together.</p>
    <ul>
      <li>Duplicator: 6 copies split 3:2:1 to three paths</li>
      <li>Shuffler: Dual output + retention (2 balls retained per cycle)</li>
      <li>Filter: Custom color routing (red match ‚Üí left, non-match ‚Üí right)</li>
      <li>Observation: 5√ó5 grid layout</li>
      <li>Merger: Combines multiple sources</li>
      <li>23 components, 30 balls, 4 hypotheses</li>
    </ul>
    <button onclick="loadComprehensiveTest()">Load Comprehensive Test</button>
    <button class="secondary" onclick="loadAndOpenEditor('comprehensive')">Load & Open Editor</button>
  </div>

  <div class="level-card">
    <h2>2. Edge Cases Test Level</h2>
    <p><strong>Purpose:</strong> Tests parameter limits and edge cases.</p>
    <ul>
      <li>Max parameters: 10 copies, capacity=10, minBufferSize=10</li>
      <li>Min parameters: 1 input, minBufferSize=1</li>
      <li>Overflow: 30+ balls to 25-capacity observation grid</li>
      <li>4-way duplicator output</li>
      <li>All-match filter scenario (empty non-match output)</li>
      <li>27 components, 50 balls for stress testing</li>
    </ul>
    <button onclick="loadEdgeCasesTest()">Load Edge Cases Test</button>
    <button class="secondary" onclick="loadAndOpenEditor('edge-cases')">Load & Open Editor</button>
  </div>

  <div class="level-card">
    <h2>3. Inference Chain Test Level</h2>
    <p><strong>Purpose:</strong> Tests complex Bayesian inference with retention.</p>
    <ul>
      <li>4 sacks with 2 alternatives each = 16 hypotheses</li>
      <li>Duplicator with plex glass (no observation inside)</li>
      <li>Shuffler with retention (tests cross-cycle dependencies)</li>
      <li>Filter with plex glass</li>
      <li>Merger combines 2 sources</li>
      <li>Arm sampling (50% rate)</li>
      <li>30 components, 20 balls</li>
    </ul>
    <button onclick="loadInferenceTest()">Load Inference Test</button>
    <button class="secondary" onclick="loadAndOpenEditor('inference')">Load & Open Editor</button>
  </div>

  <div class="level-card" style="border-color: #ff9800; background: #2d2416;">
    <h2>‚ö†Ô∏è Management</h2>
    <p>Use these buttons carefully:</p>
    <button onclick="viewLevels()">View All Levels</button>
    <button onclick="loadAllTests()">Load All 3 Tests</button>
    <button class="danger" onclick="clearLevels()">Clear All Levels</button>
  </div>

  <div id="status" class="status"></div>

  <script>
    // Test level data (embedded)
    const testLevels = {
      comprehensive: null,
      edgeCases: null,
      inference: null
    };

    // Load level JSON files
    async function loadLevelFiles() {
      try {
        const responses = await Promise.all([
          fetch('levels/comprehensive-test-level.json'),
          fetch('levels/edge-cases-test-level.json'),
          fetch('levels/inference-chain-test-level.json')
        ]);

        testLevels.comprehensive = await responses[0].json();
        testLevels.edgeCases = await responses[1].json();
        testLevels.inference = await responses[2].json();

      } catch (error) {
        console.error('Error loading test levels:', error);
        showStatus('Error loading level files. Make sure you\'re running from a web server.', 'error');
      }
    }

    // Load on page load
    loadLevelFiles();

    function getSavedLevels() {
      const saved = localStorage.getItem('bayesianFactoryLevels');
      return saved ? JSON.parse(saved) : [];
    }

    function saveLevels(levels) {
      localStorage.setItem('bayesianFactoryLevels', JSON.stringify(levels));
    }

    function addLevel(newLevel) {
      const levels = getSavedLevels();

      // Check if level with same ID already exists
      const existingIndex = levels.findIndex(l => l.meta.id === newLevel.meta.id);

      if (existingIndex !== -1) {
        // Replace existing level
        levels[existingIndex] = newLevel;
        showStatus(`Updated existing level: ${newLevel.meta.title}`, 'success');
      } else {
        // Add new level
        levels.push(newLevel);
        showStatus(`Added new level: ${newLevel.meta.title}`, 'success');
      }

      saveLevels(levels);
      return levels.length;
    }

    function loadComprehensiveTest() {
      if (!testLevels.comprehensive) {
        showStatus('Loading level file...', 'error');
        return;
      }
      const count = addLevel(testLevels.comprehensive);
      showStatus(`‚úÖ Comprehensive Test Level loaded! (Level ${count} in localStorage)`, 'success');
    }

    function loadEdgeCasesTest() {
      if (!testLevels.edgeCases) {
        showStatus('Loading level file...', 'error');
        return;
      }
      const count = addLevel(testLevels.edgeCases);
      showStatus(`‚úÖ Edge Cases Test Level loaded! (Level ${count} in localStorage)`, 'success');
    }

    function loadInferenceTest() {
      if (!testLevels.inference) {
        showStatus('Loading level file...', 'error');
        return;
      }
      const count = addLevel(testLevels.inference);
      showStatus(`‚úÖ Inference Chain Test Level loaded! (Level ${count} in localStorage)`, 'success');
    }

    function loadAllTests() {
      if (!testLevels.comprehensive || !testLevels.edgeCases || !testLevels.inference) {
        showStatus('Loading level files...', 'error');
        return;
      }
      loadComprehensiveTest();
      loadEdgeCasesTest();
      loadInferenceTest();
      showStatus('‚úÖ All 3 test levels loaded!', 'success');
    }

    function loadAndOpenEditor(levelType) {
      // Load the level first
      if (levelType === 'comprehensive') {
        loadComprehensiveTest();
      } else if (levelType === 'edge-cases') {
        loadEdgeCasesTest();
      } else if (levelType === 'inference') {
        loadInferenceTest();
      }

      // Wait a moment, then open editor
      setTimeout(() => {
        window.location.href = 'editor.html';
      }, 500);
    }

    function viewLevels() {
      const levels = getSavedLevels();

      if (levels.length === 0) {
        showStatus('No levels in localStorage', 'error');
        return;
      }

      let message = `Found ${levels.length} level(s) in localStorage:\n\n`;
      levels.forEach((level, index) => {
        message += `${index + 1}. ${level.meta.title || level.meta.id}\n`;
        message += `   ID: ${level.meta.id}\n`;
        message += `   Components: ${level.components?.length || 0}\n`;
        message += `   Balls: ${level.simulation?.ballsToSpawn || 'unknown'}\n\n`;
      });

      alert(message);
    }

    function clearLevels() {
      if (confirm('‚ö†Ô∏è This will delete ALL levels from localStorage.\n\nAre you sure?')) {
        if (confirm('Really delete everything? This cannot be undone!')) {
          localStorage.removeItem('bayesianFactoryLevels');
          showStatus('üóëÔ∏è All levels cleared from localStorage', 'success');
        }
      }
    }

    function showStatus(message, type) {
      const statusEl = document.getElementById('status');
      statusEl.textContent = message;
      statusEl.className = `status ${type}`;

      // Auto-hide after 5 seconds
      setTimeout(() => {
        statusEl.style.display = 'none';
      }, 5000);
    }
  </script>

  <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #444; color: #888; font-size: 14px;">
    <p><strong>Next Steps:</strong></p>
    <ol>
      <li>Click a "Load" button above to add test level to localStorage</li>
      <li>Open <code>editor.html</code> in your browser</li>
      <li>Click "Load Level" button in editor</li>
      <li>Select the test level from the list</li>
      <li>Click "Test Level" to run the simulation</li>
    </ol>
    <p><strong>Or use "Load & Open Editor" buttons for one-click loading!</strong></p>
    <p>See <code>QUICK_START_TESTING.md</code> for detailed testing instructions.</p>
  </div>
</body>
</html>
